# 로드 밸런싱

- 서버가 처리해야 할 업무 혹은 요청(Load)을 여러 대의 서버로 나누어(Balancing) 처리하는 것
- 한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리해 각각의 서버가 최적의 퍼포먼스를 보일 수 있도록 하는 것이 목적

<br />

![로드밸런싱](https://user-images.githubusercontent.com/76759852/195987546-ecb975c1-7102-4743-9d87-310ac1a2a848.png)

<br />

### 로드 밸런싱이 필요한 이유

- 서비스 제공 초기 단계라면 적은 수의 클라이언트로 인해 서버 한 대로 요청에 응답하는 것이 가능하지만, 서비스의 규모가 커지고 클라이언트의 수가 늘어나게 되면 기존의 서버만으로는 원활한 서비스 동작이 불가능해짐

<br />

### 증가한 트래픽에 대처할 수 있는 방법

- **Scale-Up** : 서버 자체의 성능을 확장
- **Scale-Out** : 기존 서버와 동일하거나 낮은 성능의 서버를 **두 대 이상** 증설 → 여러 대의 서버로 트래픽을 균등하게 분산해주는 **로드밸런싱**이 반드시 필요
    - **장점**
        - 서버 한 대 추가 비용 < 하드웨어 향상하는 비용
        - 여러 대의 Server 덕분에 무중단 서비스 제공

<br />

# Load Balancer

- 로드 밸런싱 기술을 제공하는 서비스 또는 장치
- 여러 대의 Server에게 균등하게 Traffic을 분산시켜주는 역할을 함
- 클라이언트와 네트워크 트래픽이 집중되는 서버들(Server Pool) 또는 네트워크 허브 사이에 위치

<br />

## 종류

- OSI 7계층을 기준으로 어떻게 부하를 분산하는지에 따라 나뉨
- 상위 계층으로 갈수록 섬세한 부하 분산이 가능하지만 가격이 비싸짐

### L2

- Data Link 계층 사용
- Mac 주소 기반 부하 분산

### L3

- Network 계층 사용
- IP 주소 기반 부하 분산

### L4

![L4](https://user-images.githubusercontent.com/76759852/195987486-45ec294f-737d-4695-9107-ed2d9541b189.png)

- Transport 계층(TCP, UDP)의 정보를 바탕으로 로드 분산
- IP 주소나 포트 번호, MAC 주소, 전송 프로토콜 등에 따라 트래픽을 나누고 분산 처리가 가능
- CLB(Connection Load Balancer) 혹은 SLB(Session Load Balancer) 라고 부르기도 함
- **장점**
    - 패킷의 내용을 확인하지 않고 로드를 분산하므로 속도가 빠르고 효율이 높음
    - 데이터의 내용을 복호화 할 필요가 없기에 안전
    - L7 로드 밸런서보다 가격이 저렴
- **단점**
    - 패킷의 내용을 살펴볼 수 없으므로 섬세한 라우팅 불가
    - 사용자의 IP 가 수시로 바뀌는 경우라면 연속적인 서비스를 제공하기 어려움

### L7

![L7](https://user-images.githubusercontent.com/76759852/195987497-90efb678-d7e5-4a50-8d39-269ac08163bb.png)

- Application 계층(HTTP, FTP, SMTP 등)에서 로드를 분산
- HTTP 헤더, 쿠키 등과 같은 사용자 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능
- 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배 가능
- **장점**
    - 상위 계층에서 로드를 분산하기 때문에 섬세한 라우팅 가능
    - 캐싱 기능 제공
    - 비정상적인 트래픽을 사전에 필터링 할 수 있어 서비스 안정성 높음
- **단점**
    - L4 로드 밸런서에 비해 비쌈
    - 패킷의 내용을 복호화 해야 하므로 비용이 비쌈
    - 클라이언트가 로드 밸런서와 인증서를 공유해야 하기 때문에, 공격자가 로드 밸런서를 통해 클라이언트의 데이터에 접근할 수 있는 보안상의 위험성 존재

<br />

## 주요 기능

### NAT (Network Address Translation)

- Private IP 주소를 Public IP 주소로 바꿈

### Tunneling

- 인터넷상에서 눈에 보이지 않는 통로를 만들어 통신할 수 있게 하는 개념
- 데이터를 캡슐화 하여 연결된 노드만 캡슐을 해제할 수 있게 만듦

### DSR (Dynamic Source Routing protocol)

- 요청에 따른 응답을 할 때 로드 밸런서가 아닌 클라이언트의 IP 로 응답

<br />

## 로드 밸런싱 알고리즘

### 라운드 로빈 방식 (Round Robin Method)

- 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
- 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용

### 가중 라운드 로빈 방식 (Weighted Round Robin Method)

- 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분하는 방식
- 서버의 트래픽 처리 능력이 상이한 경우 사용

### IP 해시 방식 (IP Hash Method)

- 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식
- 사용자의 IP를 해싱해 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장

### 최소 연결 방식 (Least Connection Method)

- 요청이 들어온 시점에 가장 적은 연결 상태를 보이는 서버에 우선적으로 트래픽을 배분하는 방식
- 트래픽으로 인해 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우 권장

### 최소 리스폰 타임 방식 (Least Response Time Method)

- 서버의 현재 연결 상태와 응답 시간을 모두 고려하여 트래픽을 배분하는 방식
- 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드 배분
